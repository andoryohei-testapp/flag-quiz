<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>国旗クイズ</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="国旗クイズ">
  <meta name="theme-color" content="#ffffff">

  <link rel="manifest" href="./manifest.json">

  <style>
    body { font-family: system-ui; margin: 16px; }
    .card { border: 1px solid #ddd; border-radius: 16px; padding: 16px; max-width: 600px; }
    button { padding: 12px; margin: 6px; border-radius: 12px; border: 1px solid #ccc; }
    .flagBox { width: 220px; border: 1px solid #eee; border-radius: 12px; overflow:hidden; }
    .flagBox img { width: 100%; display:block; }
  </style>
</head>

<body>
<div class="card">
  <h2>国旗クイズ（画像版）</h2>
<div style="margin: 8px 0 12px 0;">
  <label><input type="radio" name="mode" value="country" checked> 国旗→国名</label>
  <label style="margin-left:12px;"><input type="radio" name="mode" value="capital"> 国旗→首都</label>
</div>

  
  <p>この国旗はどこの国？</p>
  <div class="flagBox">
    <img id="flag" src="">
  </div>
<p id="prompt" style="margin:10px 0 0 0; font-weight:700;"></p>
  <div id="choices"></div>
  <p id="result"></p>

  <button onclick="newQuestion()">次の問題</button>
</div>

<script>
let DATA = [];

async function loadData(){
  const res = await fetch("./data_with_kana.json");
  DATA = await res.json();
}

async function start(){
  await loadData();
  newQuestion();
}

start();


function flagPath(code){
  return "./flags/4x3/" + code + ".svg";
}

let current = null;

function getMode(){
  return document.querySelector('input[name="mode"]:checked')?.value || "country";
}
// 首都ふりがな（足りない分だけ上書き）
const CAPITAL_KANA_OVERRIDE = {
  "Kralendijk": "クラレンダイク",
  "El Aaiún": "アイウン",
  "City of Victoria": "ヴィクトリアシ",
  "Saipan": "サイパン",
  "Longyearbyen": "ロングイェールビーン",
  "Washington DC": "ワシントンディーシー",
  "Vatican City": "バチカン",
};

function newQuestion(){
  document.getElementById("result").textContent = "";

  // データ未読込ガード
  if (!DATA.length) return;

  const mode = getMode();

  // mode=capital のときは「首都が入ってる国」だけを出題対象にする
  let pool = DATA;
  if (mode === "capital") {
    pool = DATA.filter(x => (x.capital || "").trim().length > 0);
    if (!pool.length) {
      document.getElementById("result").textContent = "首都データがある国がありません";
      return;
    }
  }

  const i = Math.floor(Math.random() * pool.length);
  current = pool[i];
// 国名表示（首都モードのときだけ）
const prompt = document.getElementById("prompt");
if (mode === "capital") {
  prompt.textContent = current.name + " の首都は？";
} else {
  prompt.textContent = "";
}

  document.getElementById("flag").src = flagPath(current.code);

  // choices（必ず正解を含める）
  let choices = [current];

  while (choices.length < 4) {
    const candidate = pool[Math.floor(Math.random() * pool.length)];
    if (!choices.some(c => c.code === candidate.code)) {
      choices.push(candidate);
    }
  }

  choices = choices.sort(() => Math.random() - 0.5);

  const div = document.getElementById("choices");
  div.innerHTML = "";

  choices.forEach(c=>{
    const btn = document.createElement("button");

    // 表示ラベル：国名 or 首都
    if (mode === "capital") {
const cap = c.capital || "（不明）";
const kanaRaw = CAPITAL_KANA_OVERRIDE[cap] || c.capital_kana || "";
const kana = kanaRaw ? `（${kanaRaw}）` : "";
btn.textContent = cap + kana;

} else {
  btn.textContent = c.name;
}


   btn.onclick = () => {
  const result = document.getElementById("result");

  if (c.code === current.code) {
    result.textContent = "正解！";
    return;
  }

  if (mode === "capital") {
    const cap = current.capital || "（不明）";
    const kanaRaw = (typeof CAPITAL_KANA_OVERRIDE !== "undefined" ? (CAPITAL_KANA_OVERRIDE[cap] || "") : "")
                 || current.capital_kana
                 || "";
    const kana = kanaRaw ? `（${kanaRaw}）` : "";
    result.textContent = "不正解… 正解は " + cap + kana;
  } else {
    result.textContent = "不正解… 正解は " + current.name;
  }
};


    div.appendChild(btn);
  });
}



</script>

</body>
</html>







